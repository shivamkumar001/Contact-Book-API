

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login & Dashboard</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #f0f0f0;
        }

        .container {
            width: 400px;
            padding: 20px;
            border-radius: 5px;
            background-color: #fff;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            text-align: center;
        }

        input[type="text"],
        input[type="password"],
        button {
            display: block;
            width: 100%;
            margin-bottom: 10px;
            padding: 8px;
            font-size: 16px;
            border-radius: 3px;
            border: 1px solid #ccc;
        }

        button {
            background-color: #007bff;
            color: #fff;
            cursor: pointer;
        }

        button:hover {
            background-color: #0056b3;
        }

        .error-message {
            color: red;
            text-align: center;
        }

        #dashboard {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container" id="login-container">
        <h2>Login</h2>
        <form id="login-form">
            <input type="text" id="username" placeholder="Username" required>
            <input type="password" id="password" placeholder="Password" required>
            <button type="submit">Login</button>
        </form>
        <p id="login-error-message" class="error-message"></p>
    </div>

    <div class="container" id="dashboard">
        <h2>Contacts</h2>
        <div id="contact-list"></div>
        <form id="add-contact-form">
            <input type="text" id="name" placeholder="Name" required>
            <input type="text" id="email" placeholder="Email" required>
            <input type="text" id="ContactId" placeholder="ContactId" required>
            <input type="text" id="MOB" placeholder="MOB" required>
            <input type="text" id="username" placeholder="username" required>
            <input type="text" id="Group" placeholder="Group" required>
            <button type="submit">Add Contact</button>
        </form>
        <p id="error-message" class="error-message"></p>

        <h2>Search Contacts by Group</h2>
        <form id="search-contact-form">
            <input type="text" id="Group" placeholder="Group" required>
            <button type="submit">Search</button>
        </form>
        <div id="search-results"></div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const loginContainer = document.getElementById('login-container');
            const dashboardContainer = document.getElementById('dashboard');
            const loginForm = document.getElementById('login-form');
            const errorMessage = document.getElementById('login-error-message');

            // Function to handle login
            loginForm.addEventListener('submit', async function(event) {
                event.preventDefault();

                const username = document.getElementById('username').value;
                const password = document.getElementById('password').value;

                try {
                    const response = await fetch('http://127.0.0.1:8000/auth/auth/token', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded'
                        },
                        body: `username=${username}&password=${password}`
                    });

                    if (!response.ok) {
                        throw new Error('Invalid username or password');
                    }

                    const data = await response.json();
                    localStorage.setItem('accessToken', data.access_token);
                    loginContainer.style.display = 'none';
                    dashboardContainer.style.display = 'block';
                    fetchContacts();
                } catch (error) {
                    errorMessage.textContent = error.message;
                }
            });

            // Function to fetch contacts
            async function fetchContacts() {
                try {
                    const token = localStorage.getItem('accessToken');
                    if (!token) {
                        throw new Error('Access token not found');
                    }

                    const response = await fetch('http://127.0.0.1:8000/find/contacts?username=abhi123&password=123456', {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Failed to fetch contacts');
                    }

                    const contacts = await response.json();
                    displayContacts(contacts);
                } catch (error) {
                    console.error('Error fetching contacts:', error);
                }
            }

            // Function to display contacts
            function displayContacts(contacts) {
                const contactList = document.getElementById('contact-list');
                contactList.innerHTML = '';
                contacts.forEach(contact => {
                    const contactElement = document.createElement('div');
                    contactElement.innerHTML = `
                        <p>Name: ${contact.name}</p>
                        <p>Email: ${contact.email}</p>
                        <p>ContactId: ${contact.ContactId}</p>
                        <p>MOB: ${contact.MOB}</p>
                        <p>username: ${contact.username}</p>
                        <p>Group: ${contact.Group}</p>
                        <button onclick="deleteContact('${contact._id}')">Delete</button>
                    `;
                    contactList.appendChild(contactElement);
                });
            }

            // Function to add a new contact
            const addContactForm = document.getElementById('add-contact-form');
            addContactForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                const ContactId = document.getElementById('ContactId').value;
                const name = document.getElementById('name').value;
                const MOB = document.getElementById('MOB').value;
                const username = document.getElementById('username').value;
                const Group = document.getElementById('Group').value;
                const email = document.getElementById('email').value;
                const password = "123456";
                try {
                    const response = await fetch('http://127.0.0.1:8000/create/contacts?username=abhi123&password=123456', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${localStorage.getItem('accessToken')}`
                        },
                        body: JSON.stringify({ name, email, MOB, username, Group, ContactId})
                    });

                    if (!response.ok) {
                        throw new Error('Failed to add contact');
                    }

                    fetchContacts();
                    addContactForm.reset();
                } catch (error) {
                    errorMessage.textContent = error.message;
                }
            });

            // Function to delete a contact
            window.deleteContact = async function(id) {
                try {
                    const response = await fetch(`http://localhost:8000/${id}`, {
                        method: 'DELETE',
                        headers: {
                            'Authorization': `Bearer ${localStorage.getItem('accessToken')}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Failed to delete contact');
                    }

                    fetchContacts();
                } catch (error) {
                    console.error('Error deleting contact:', error);
                }
            };

            // Function to search contacts by group
            const searchContactForm = document.getElementById('search-contact-form');
            searchContactForm.addEventListener('submit', async function(event) {
                event.preventDefault();
                const Group = document.getElementById('Group').value;
                try {
                    const token = localStorage.getItem('accessToken');
                    if (!token) {
                        throw new Error('Access token not found');
                    }

                    const response = await fetch(`http://localhost:8000/search/relation/${Group}?username=abhi123&password=123456`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (!response.ok) {
                        throw new Error('Failed to search contacts by group');
                    }

                    const contacts = await response.json();
                    displaySearchResults(contacts);
                } catch (error) {
                    console.error('Error searching contacts:', error);
                }
            });

            // Function to display search results
            function displaySearchResults(contacts) {
                const searchResults = document.getElementById('search-results');
                searchResults.innerHTML = '';
                contacts.forEach(contact => {
                    const contactElement = document.createElement('div');
                    contactElement.innerHTML = `
                        <p>Name: ${contact.name}</p>
                        <p>Email: ${contact.email}</p>
                    `;
                    searchResults.appendChild(contactElement);
                });
            }
        });
    </script>
</body>
</html>
